# glue
`glue` is a Python library with the most common tools for command-line applications.

`glue` lets you to bind Command-Line rules with a particular action (function). 

It is compatible with both Python 2.7 and 3.5+.

## Command line parser
`glue` contains command line parser with autocompletion,
which simplifies and speeds up developing process of simple command-line applications.

You only need to bind a keyword to the function and `glue` is doing all the rest for you:
* It autogenerates `help` message screen.
* It adds standard options `--help`, `--version`, `-h`, `-v` by default.
* It parses automatically all the commands, flags and parameters.
* It provides bash autocompletion feature
(by pressing `Tab` you get the most relevant CLI arguments hints and autocompletion)
* It can be extended by your custom auto-completers for your commands
* It supports multilevel subcommands (`git` style alike syntax, i.e. `git remote set-url --add origin url`)
* It supports both parameters syntaxes: `--param value` or `--param=value`

## Features:
* Command Line Arguments processor (parser): binding commands, flags, parameters
* Autogenerating help output
* Tools for keeping compatibility with Python 2.7 and 3 (input)
* Terminal logger helpers (coloured loglevel messages)
* Shell commands executing (with outputs and error codes)
* RegEx helpers: matching, filtering, replacing, extracting data, batch operations
* Easy string operations: splitting, splitting to tuples
* Basic file operations helpers
* Datetime to string (and vice-versa) convertions

## Quick start

Let's create simple command-line application using `glue`:

##### sample_app.py:

```python
#!/usr/bin/env python
# -*- coding: utf-8 -*-
import glue


# ----- Actions -----
def action_hello(ap):
    """
    Displays hello message with user name
    :param ap: ArgsProcessor - You can get the parameter values,
    flags states or any other CLI argument from here
    """
    name = ap.poll_next('name')  # get first arg from args queue
    if ap.is_param('surname'):  # optional param 'surname'
        name += ' ' + ap.get_param('surname')  # get param 'value'
    print('Hello %s' % name)
    if ap.is_flag_set('force'):  # check flag is set
        print('May the Force be with you!')

# ----- CLI definitions -----
def main():
    # app name and version for help printing
    ap = glue.ArgsProcessor(app_name='Sample glue application', version='1.0.1')
    
    # bind 'hello' keyword with action_hello function
    ap.add_subcommand('hello', action=action_hello, syntax='<name>', help='display hello message')
    # enable param 'surname' (bind to '--surname <surname>' or '--surname=<surname>' syntax)
    ap.add_param('surname', help='set custom surname', choices=['brian', 'janusz', 'brianusz'])
    # bind 'force' flag to keywords '-f' or '--force'
    ap.add_flag('force', keywords=['-f', '--force'], help='enable force mode')
    
    # do the magic
    ap.process()


if __name__ == '__main__':
    main()  # it will not be invoked when importing this module for testing purposes
```

#### Autogenerated help output
Let's see how the `help` screen looks like.
Run in terminal any of the following commands:

* `./sample_app.py`,
* `./sample_app.py -h`,
* `python sample_app.py --help`,
* `./sample_app.py --help`

All of them will output:
```shell
$ ./sample_app.py --help
Sample glue application v1.0.1

Usage:
  ./sample_app.py [options] <command>

Commands:
  hello <name>                  - display hello message

Options:
  -f, --force                   - enable force mode
  --surname <surname>           - set custom surname
  -h, --help                    - display this help and exit
  -v, --version                 - print version
  --bash-install <appname>      - installs bash script and autocompletion
  --bash-autocomplete <cmdline> - return autocompletion list
```

#### Invoking a command
Check the following commands output:
```shell
$ ./sample_app.py hello dupa
Hello dupa
$ ./sample_app.py hello dupa --force
Hello dupa
May the Force be with you!
$ python sample_app.py hello dupa --surname myOldFriend
Hello dupa myOldFriend
```

#### Installing Autocompletion
In order to enable the autocompletion, there must be a specific script in `/etc/bash_completion.d/`.
With glue you just need to run:
```shell
# sudo ./sample_app.py --bash-install sample_app
```
It will install autocompletion script and add a symbolic link in `/usr/bin/`,
so now you can run your app with `sample_app` command instead of `./sample_app.py`.

Now you can type `sample_app` and hit `Tab` to see what are the possible commands and options.

If you type `sample_app he`, it will automatically fill the only possible option (`hello`).

#### Multilevel commands parser

We need to make some modifications in our code,
but after these modifications you will NOT need to reinstall autocompletion again.
You had to do it only once.

Let's modify our example code a little bit. Now it will be a tool for setting xrandr primary screen:

##### sample_app.py:
```python
#!/usr/bin/env python
# -*- coding: utf-8 -*-
import glue


# ----- Actions -----
def action_list_screens():
    glue.info('Available screens: %s' % ', '.join(list_xrandr_screens()))


def action_primary_screen(ap):
    screen_name = ap.poll_next('screen')
    glue.shell('xrandr --output %s --primary' % screen_name)
    glue.info('%s set as primary' % screen_name)


def list_xrandr_screens():
    xrandr = glue.shell_output('xrandr 2>/dev/null')
    lines = glue.nonempty_lines(xrandr)
    lines = glue.regex_filter_list(lines, r'^([a-zA-Z0-9\-]+) connected')
    return glue.regex_replace_list(lines, r'^([a-zA-Z0-9\-]+) connected(.*)', '\\1')


# ----- CLI definitions -----
def main():
    # app name and version for help printing
    ap = glue.ArgsProcessor(app_name='Sample glue application', version='1.0.2')

    # multilevel subcommands
    ap_screen = ap.add_subcommand('screen')
    ap_screen.add_subcommand('list', action=action_list_screens, help='list available screens')
    ap_screen.add_subcommand('primary', syntax='<screen>', action=action_primary_screen,
                             choices=list_xrandr_screens, help='set primary screen')

    # do the magic
    ap.process()


if __name__ == '__main__':
    main()  # it will not be invoked when importing this module for testing purposes
```

As you see, the `help` message is now slightly different:
```shell
$ sample_app --help
Sample glue application v1.0.1

Usage:
  sample_app.py [options] <command>

Commands:
  screen list                   - list available screens
  screen primary <screen>       - set primary screen

Options:
  -h, --help                    - display this help and exit
  -v, --version                 - print version
  --bash-install <appname>      - installs bash script and autocompletion
  --bash-autocomplete <cmdline> - return autocompletion list
```

Now you can list available screens by `screen list` subcommand
or type `screen primary` subcommand and see the possible values when hiting `Tab`:

```shell
$ sample_app screen [Tab]
list    primary
$ sample_app screen list [Enter]
[info]  Available screens: eDP1, HDMI2
$ sample_app screen primary [Tab]
eDP1    HDMI2
$ sample_app screen primary HD[Tab]
$ sample_app screen primary HDMI2 [Enter]
[info]  HDMI2 set as primary
```


## Library Installation
Copy `glue.py` to your project folder and add it to imports (just like in the examples shown above).
You will need to install some packages used by glue:
### Installing Python 2.7 packages
```shell
# apt install python-pip # (for Debian)
# pip2 install future
```
testing modules (optional but it's useful):
```shell
# pip2 install pytest coverage mock
```
### Installing Python 3 packages
```shell
# apt install python3-pip # (for Debian)
# pip3 install future
```
testing modules (optional but it's useful):
```shell
# pip3 install pytest coverage mock
```

### Running tests
Running tests on both Python 2 and 3:
```shell
git clone https://github.com/igrek51/glue
cd glue
./pytest23.sh
```
