# Usage


#### Autogenerated help output
Let's see how the `help` screen looks like.
Run in terminal any of the following commands:

* `./sample_app.py`,
* `./sample_app.py -h`,
* `python sample_app.py --help`,
* `./sample_app.py --help`

All of them will output:
```shell
$ ./sample_app.py --help
Sample glue application v1.0.1

Usage:
  ./sample_app.py [options] <command>

Commands:
  hello <name>                  - display hello message

Options:
  -f, --force                   - enable force mode
  --surname <surname>           - set custom surname
  -h, --help                    - display this help and exit
  -v, --version                 - print version
  --bash-install <appname>      - installs bash script and autocompletion
  --bash-autocomplete <cmdline> - return autocompletion list
```

#### Invoking a command
Check the following commands output:
```shell
$ ./sample_app.py hello dupa
Hello dupa
$ ./sample_app.py hello dupa --force
Hello dupa
May the Force be with you!
$ python sample_app.py hello dupa --surname myOldFriend
Hello dupa myOldFriend
```

#### Installing Autocompletion
In order to enable the autocompletion, there must be a specific script in `/etc/bash_completion.d/`.
With glue you just need to run:
```shell
# sudo ./sample_app.py --bash-install sample_app
```
It will install autocompletion script and add a symbolic link in `/usr/bin/`,
so now you can run your app with `sample_app` command instead of `./sample_app.py`.

Now you can type `sample_app` and hit `Tab` to see what are the possible commands and options.

If you type `sample_app he`, it will automatically fill the only possible option (`hello`).

#### Multilevel commands parser

We need to make some modifications in our code,
but after these modifications you will NOT need to reinstall autocompletion again.
You had to do it only once.

Let's modify our example code a little bit. Now it will be a tool for setting xrandr primary screen:

##### sample_app.py:
```python
#!/usr/bin/env python
# -*- coding: utf-8 -*-
import glue


# ----- Actions -----
def action_list_screens():
    glue.info('Available screens: %s' % ', '.join(list_xrandr_screens()))


def action_primary_screen(ap):
    screen_name = ap.poll_next('screen')
    glue.shell('xrandr --output %s --primary' % screen_name)
    glue.info('%s set as primary' % screen_name)


def list_xrandr_screens():
    xrandr = glue.shell_output('xrandr 2>/dev/null')
    lines = glue.nonempty_lines(xrandr)
    lines = glue.regex_filter_list(lines, r'^([a-zA-Z0-9\-]+) connected')
    return glue.regex_replace_list(lines, r'^([a-zA-Z0-9\-]+) connected(.*)', '\\1')


# ----- CLI definitions -----
def main():
    # app name and version for help printing
    ap = glue.ArgsProcessor(app_name='Sample glue application', version='1.0.2')

    # multilevel subcommands
    ap_screen = ap.add_subcommand('screen')
    ap_screen.add_subcommand('list', action=action_list_screens, help='list available screens')
    ap_screen.add_subcommand('primary', syntax='<screen>', action=action_primary_screen,
                             choices=list_xrandr_screens, help='set primary screen')

    # do the magic
    ap.process()


if __name__ == '__main__':
    main()  # it will not be invoked when importing this module for testing purposes
```

As you see, the `help` message is now slightly different:
```shell
$ sample_app --help
Sample glue application v1.0.1

Usage:
  sample_app.py [options] <command>

Commands:
  screen list                   - list available screens
  screen primary <screen>       - set primary screen

Options:
  -h, --help                    - display this help and exit
  -v, --version                 - print version
  --bash-install <appname>      - installs bash script and autocompletion
  --bash-autocomplete <cmdline> - return autocompletion list
```

Now you can list available screens by `screen list` subcommand
or type `screen primary` subcommand and see the possible values when hiting `Tab`:

```shell
$ sample_app screen [Tab]
list    primary
$ sample_app screen list [Enter]
[info]  Available screens: eDP1, HDMI2
$ sample_app screen primary [Tab]
eDP1    HDMI2
$ sample_app screen primary HD[Tab]
$ sample_app screen primary HDMI2 [Enter]
[info]  HDMI2 set as primary
```

